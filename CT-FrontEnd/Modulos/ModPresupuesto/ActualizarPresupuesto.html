  
  <div class="card w-50 my-1" style="margin-left: 20%; margin-right: 20%" >
    <div class="row text-center" >
      <div class="col-12 my-4 h3-responsive font-weight-bold">ACTUALIZAR POR CÓDIGO:</div>
      <div class="col-12 h6 mt-4"><input id="valor" type="text" class="m-0 p-0 py-1 font-weight-bold" style="margin-left: 5%; margin-right: 5%;  width: 90%" ></div>
      <div class="col-12 h6"><input type="button" id="buscar" value="BUSCAR" class="btn btn-titulo enfasis2" ></div>
      

    </div>
    <div class="text-center form-card  form-group">
      <div class="col-12 my-4 h3-responsive font-weight-bold">LISTAR PRESUPUESTOS</div>
      <div class="form-inline">
      
      <div class="h5-responsive font-weight-bold" style="margin-left: 7%; margin-right: 7%">
        <select class="form-control text-left font-weight-bold" style="width: 200px;" id="presupuestos"><option value="0">-</option></select>
      </div>
      
      <div class="h5-responsive font-weight-bold" style="margin-left: 7%; margin-right: 7%">
        <select class="form-control text-center font-weight-bold" id="item"><option value="0">Elegir Item</option></select>
      </div>
      
      </div>
      
      <div class="my-3">
      <button id="mostrar"class="text-right btn btn-titulo enfasis3 ">Mostrar</button>
      <button class="text-right btn btn-titulo strong5 " id="editarItem" >Editar</button>
      </div>
    </div>
  </div>
  
  <!-- INFORMACION X PRESUPUESTO -->
  <div class="card my-2">
     <div class="form-inline ">
      <div id="nPresupuesto" class="col-12 my-4 h3-responsive font-weight-bold">PRESUPUESTO</div>
    </div>
    <div class="form-inline text-center my-2"  style="margin-left: 2%; margin-right: 2%">
       <div class="row mx-1" style="width: 18%">
         <div class="text-center font-weight-bold" style="margin-left: 5%; margin-right: 5%">CLIENTE: </div>
         <select readonly class="form-control font-weight-bold" style="height : 38px;width: 90%; border-color:blue" id="cliente"><option value="">-</option></select>
       </div>
       <div class="row mx-1" style="width:18%">
         <div class="text-center font-weight-bold" style="margin-left: 5%; margin-right: 5%">PERSONA CONTACTO: </div>
         <input readonly class="form-control" id="persona" style=" width: 90%; border-color:blue" type="text">
       </div>
       <div class="row mx-1" style="width:18%">
         <div class="text-center font-weight-bold" style="margin-left: 5%; margin-right: 5%">VENDEDOR : </div>
         <select readonly class="form-control font-weight-bold" id="vendedor" style="width: 90%;height : 38px; border-color:blue" >
                        <option value="49">PEPE</option>
                        <option value="35">FABIOLA</option>
                        <option value="39">YRMA</option>
                        <option value="54">MILAGROS</option>
                        <option value="28">LIZ</option>
                        <option value="74">ALAN</option>
                      </select>
       </div>
       <div class="row mx-1" style="width:18%">
         <div class="text-center font-weight-bold" style="margin-left: 5%; margin-right: 5%">PRECIO TOTAL S/: </div>
         <input readonly class="form-control" id="montoSoles" style="width: 90%; border-color:blue" type="text">
       </div>
       <div class="row mx-1" style="width:18%">
         <div class="text-center font-weight-bold" style="margin-left: 5%; margin-right: 5%">PRECIO TOTAL $: </div>
         <input readonly class="form-control" id="montoDolares" style="width: 90%; border-color:blue" type="text">
       </div>
    </div>
   <!-- <button class="btn btn-titulo enfasis3" data-toggle="modal" data-target="#modalMonto">CAMBIAR MONTO</button>-->
  </div>
  <div class="card my-2">
    <div class="col-12 my-3 h3-responsive font-weight-bold" style="margin-left: 10%;width: 80%">ITEM - PRESUPUESTO</div>
    
    <table id="detalleItem" style="margin-left: 15%; margin-right: 15%; width: 70%"></table>
    <div id="valorTotal" class='font-weight-bold pt-3' style="margin-left: 14%;"></div>
    <div id="divAgregarItem" class="col-12 h6 d-none my-1" style="margin-left: 40%;" ><input type="button" id="agregar" onclick="agregarItem();return false" value="AGREGAR ITEM" class="btn btn-titulo enfasis2"  ></div>
  </div>
  <!--MODAL : MEDIDAS DEL ITEM - PPTO-->
    <div class="modal fade" id="modalMonto" tabindex="-1" role="dialog" aria-labelledby="modalMonto"
      aria-hidden="true">
      <div class="modal-dialog" role="document" id="mdialTamanio">
        <div class="modal-content" style="width: 400px">

          <div class="modal-header principal">
            <h5 class="modal-title white-text font-weight-bold">CAMBIAR MONTO</h5>
            <input type="hidden" id="itemsPresupuesto">
          </div>
          <div class="modal-body">
              <table  class="w-100">
                  <thead >
                    <tr><td class="font-weight-bold" >MONTO EN SOLES :</td></tr>
                    <tr><td><input class="form-control" type="text" style="width: 90%; border-color:blue; " placeholder="S/" id="montoenSoles" ></td></tr>
                    <tr><td class="font-weight-bold"  >MONTO EN DOLARES :</td></tr>
                    <tr><td><input class="form-control" type="text" style="width: 90%; border-color:blue; " placeholder="$" id="montoenDolares"></td></tr>
                  </thead>
                  <tfoot>
                    <tr><td><input class="btn btn-titulo principal" style="margin-left: 15%" data-dismiss="modal" onclick="guardarModal();return false" value="GUARDAR"></td></tr>
                  </tfoot>
              </table>
          </div>
        </div>   
      </div>
    </div>

<!--ARCHIVOS JS DE LA VISTA-->
<script type="text/javascript" src="Modulos/ModPresupuesto/VistaPresupuesto.js"></script>
<script src="Bootstrap/js/select2.min.js"></script>
<link href="Bootstrap/css/select2.min.css" rel="stylesheet"/>
<script>
  
datos.mostrarPresupuestos();
datos.mostrarCliente();
    
jQuery(document).ready(function($){
    $(document).ready(function() {
        $('#presupuestos').select2();
    });
});
 
  
/* BUSCAR Y MOSTRAR LOS ITEMS DE EL PRESUPUESTO - SELECT*/
$("#presupuestos").change(function(){
  mostrarItemXPresupuesto($("#presupuestos").val());
  mostrarItem($("#presupuestos").val())
});
  
/*BUSCAR LA INFORMACION DE EL PRESUPUESTO - CAJA DE TEXTO*/
$("#buscar").click(function(){
  if( $("#valor").val()=="" ){
   $("#valor").focus();
   $("#presupuestos").val("");
   $("#detalleItem").html("");
  }else{
     mostrarItem($("#valor").val());
     $("#presupuestos").val($("#valor").val());
     mostrarItemXPresupuesto($("#presupuestos").val());
     mostrarItem($("#presupuestos").val())
  }
});
  
/* MOSTRAR LA INFORMACION DEL PRESUPUESTO */  
$("#editarItem").click(function(){
   if($("#item").val() != "0"){
     NuevoPresupuesto();
   }
});
  
/* MOSTRAR LA INFORMACION DEL PRESUPUESTO */  
$("#mostrar").click(function(){
  if( $("#presupuestos").val() != "ELegir Presupuesto"){
    mostrarItem($("#presupuestos").val() );
  }
});
  
/* BUSCAR LOS ITEMS DEL PRESUPUESTO SELECCIONADO*/
function mostrarItemXPresupuesto(opcion){
    var boxiTEM="";
    var $codigo={
        '_codigo': opcion 
    }
    $.ajax({
        url: '../CT-BackEnd/Controlador/ModPresupuesto/Controlador_ValidarPresupuesto.php',
        type: 'POST',
        data: $codigo,
        dataType: 'json',
        error: function(error){
            if(error.status == 401){
              mostrarMensaje("error","Archivos no encontrados");
            }
            else{
              mostrarMensaje("error","Error no identificado");
            }
            boxiTEM+="<option value='0' selected>Elegir Item</option>";
            $("#item").html(boxiTEM);
        },
        success: function(datos){
          if(datos.response=="1"){
              boxiTEM+="<option value='0' selected>Elegir Item</option>";
              $("#item").html(boxiTEM);
          }else{
              boxiTEM+="<option value='0' selected>Elegir Item</option>";
             for(var i=0; i<datos.length;i++){
                boxiTEM+="<option value='"+datos[i].ITPRESUNUMERO+"'>"+datos[i].ITPRESUCODIGO+" - "+datos[i].ITPRESUDESCRIPCION+"</option>";
                }
            $("#item").html(boxiTEM);
          }
        }
    });
  }
 
/* MOSTRAR INFORMACION DE CADA ITEM */
function mostrarItem(codigo){
  
   var $codigo={
        '_codigo': codigo }
     
    $.ajax({
        url: '../CT-BackEnd/Controlador/ModPresupuesto/Controlador_ValidarPresupuesto.php',
        type: 'POST',
        data: $codigo,
        dataType: 'json',
        error: function(error){
            if(error.status == 401){
                mostrarMensaje("error","Archivos no encontrados");
                $("#detalleItem").html("");
                $("#persona").val("");$("#nPresupuesto").html("PRESUPUESTO");$("#cliente").val(0);
                $("#vendedor").val(49);$("#montoSoles").val("");$("#montoDolares").val("");
                $("#divAgregarItem").addClass("d-none");
            }
            else{
                mostrarMensaje("error","Error no identificado");
                $("#detalleItem").html("");
                $("#persona").val("");$("#nPresupuesto").html("PRESUPUESTO");$("#cliente").val(0);
                $("#vendedor").val(49);$("#montoSoles").val("");$("#montoDolares").val("");
                $("#divAgregarItem").addClass("d-none");
            }
        },
        success: function(datos){
 
          if(datos.response=="0"){
              $("#detalleItem").html("");
              $("#persona").val("");$("#nPresupuesto").html("PRESUPUESTO");$("#cliente").val(0);
              $("#vendedor").val(49);$("#montoSoles").val("");$("#montoDolares").val("");
              $("#divAgregarItem").addClass("d-none");
          }
          else{
              $("#itemsPresupuesto").val(datos[0].PRESUPCANT_ITEM);
              $("#nPresupuesto").html("PRESUPUESTO: "+datos[0].PRESUPNUMERO);
              var tablaItem="";
              var preciototal=0;
              var precioSoles=0;
              var precioDolares=0;
              var tipoMonedaSoles ="";
              var itemstotales = 0;
              var tipoMonedaDolares ="";
              var valorTotal= "";
              var valorVenta= "Total : ";
              var valorTotalSoles = "VALOR TOTAL EN SOLES : ";
              var valorTotalDolares = "VALOR TOTAL EN DOLARES : ";
              var elementos = new Array();      
              var estadoelementos = new Array();      
              var precio = new Array();      
              for(var i=0; i<datos.length; i++){
                elementos[i] = datos[i].ITPRESUCODIGO;
                estadoelementos[i] = datos[i].ESTDESCRIPCION;
                if(datos[i].ITPRESUIMPORTE.substr(0,1)=="S"){
                    precio[i] = datos[i].ITPRESUIMPORTE.substr(3);
                }else{
                    precio[i] = datos[i].ITPRESUIMPORTE.substr(1);
                }
              }
              var cantidad = [];
              var costoItem = [];
              var estadoAceptado = [];
              var repetidos = [];
              var temporal = [];
              elementos.forEach((value,index)=>{
              temporal = Object.assign([],elementos);
              temporal.splice(index,1);
                if(temporal.indexOf(value)!=-1 && repetidos.indexOf(value)==-1)      repetidos.push(value);
              }); 
              var repeat = 0;
              var dinner = 0;
              var status = "NO";
              for(var i=0; i<repetidos.length; i++){
                 for(var j=0; j<elementos.length; j++){
                     if(repetidos[i]==elementos[j]){
                       if(estadoelementos[j]=="ACEPTADO"){
                         status="SI"; // SI EL SUB-ITEM PRESUPUESTO ESTÁ ACEPTADO, EL ITEM PRESUPUESTO Y DE ORDEN DE PRODUCCIÓN TAMBIÉN
                       }
                       repeat=repeat+1; // CANTIDAD DE SUB-ITEM POR ITEM
                       dinner=dinner+parseFloat(precio[j]); // SUMA DE COSTO DE SUB-ITEM POR ITEM PRESUPUESTO
                     }
                   }
                estadoAceptado[i]=status;
                status="NO"
                cantidad[i]=repeat;
                repeat=0;
                costoItem[i]=dinner;
                dinner=0;
               }
             
              var contador = 0;
              var posicion = 0;
              var respuesta = "NO";
              var tipoItem = "NO";
            var cantidadaceptado= 0
              for(var i=0; i<datos.length; i++){
                var item=datos[i].ITPRESUCODIGO;
                for(var k=0; k<repetidos.length; k++){
                  if(datos[i].ITPRESUCODIGO == repetidos[k]){
                    tipoItem="SI";
                    contador= contador+1;
                    if (contador==cantidad[k]){
                      respuesta="SI";
                      posicion=k;
                      contador=0;
                    }
                  }
                }

                item = item.substr(8);
                itemstotales= item
                var impresion;
                var colores;
                if(datos[i].DETPRESUPNUM_COLOR==4){
                  colores="FULL COLOR";
                }
                else{
                  colores=datos[i].DETPRESUPNUM_COLOR+" colores";
                }

                if(datos[i].DETPRESUPTIPO_IMPRESION==1){
                      impresion="SOLO TIRA";
                }
                else if(datos[i].DETPRESUPTIPO_IMPRESION==2){
                      impresion="T/R APARTE";
                }
                else  if(datos[i].DETPRESUPTIPO_IMPRESION==3){
                      impresion="T/R JUNTA";
                }
                var acabados="";
                if (datos[i].DETPRESUPBARNIZ_PLASTI==0 || datos[i].DETPRESUPBARNIZ_PLASTI==null || datos[i].DETPRESUPBARNIZ_PLASTI.length==0){}else{    acabados+=""+datos[i].DETPRESUPBARNIZ_PLASTI+ " <br />"; }

                if (datos[i].DETPRESUPBARNIZ_PLASTI1==0 || datos[i].DETPRESUPBARNIZ_PLASTI1==null || datos[i].DETPRESUPBARNIZ_PLASTI1.length==0){}else{    acabados+=""+datos[i].DETPRESUPBARNIZ_PLASTI1+"  <br />"; }

                if (datos[i].DETPRESUPBARNIZ_PLASTI2==0 || datos[i].DETPRESUPBARNIZ_PLASTI2==null || datos[i].DETPRESUPBARNIZ_PLASTI2.length==0){}else{    acabados+=""+datos[i].DETPRESUPBARNIZ_PLASTI2+" <br />"; }

                if (datos[i].DETPRESUPTROQUEL=="-" || datos[i].DETPRESUPTROQUEL==""){}else{    acabados+="TROQUELADO - "+datos[i].DETPRESUPTROQUEL+" <br />"; } 

                if (datos[i].DETPRESUPDOBLADO_ALCE=="NO"){}else{    acabados+="DOBLADO - "+datos[i].DETPRESUPDOBLADO_ALCE+" <br />"; } 

                if (datos[i].DETPRESUPCOSIDO_COLA_GRAPA=="NO"){}else{    acabados+="ALCE - "+datos[i].DETPRESUPCOSIDO_COLA_GRAPA+" <br />"; }

                if (datos[i].DETPRESUPCAJA_PAQUETE==0 || datos[i].DETPRESUPCAJA_PAQUETE==null || datos[i].DETPRESUPCAJA_PAQUETE.length==0){}
                else{
                  if(datos[i].DETPRESUPCAJA_PAQUETE=="CAJA"){
                        acabados+="ENCAJONADO <br />";
                    }
                    else{
                       acabados+="EMPAQUETADO DE "+datos[i].DETPRESUPCAJA_PAQUETE+" unidades X PAQUETE <br />";
                    }
                }

                if (datos[i].DETPRESUPCOSTO_COLA_FORRO==0){}else{    acabados+="ENCOLADO Y FORRADO <br />"; } 

                if (datos[i].DETPRESUPCOSTO_CORTE==0){}else{    acabados+="DEGOLLADO Y CORTE <br />"; } 

                if (datos[i].DETPRESUPCOSTO_ARMADO==0){}else{    acabados+="ARMADO Y PEGADO DE BOLSILLO <br />"; } 

                if (datos[i].DETPRESUPCOSTO_OJAL==0){}else{    acabados+="PUESTA DE OJALILLOS <br />"; } 

                if (datos[i].DETPRESUPCOSTO_NYLON==0){}else{    acabados+="NYLON 0.7mm <br />";}

                tablaItem+="<tr>\
                              <td class='font-weight-bold pt-3' colspan='3' style='text-decoration: underline' >"+ item+ ". "+ datos[i].ITPRESUDESCRIPCION+"</td>\
                            </tr>\
                            <tr>\
                              <td>Cantidad</td>\
                              <td>:</td>\
                              <td class='descripcion'>"+datos[i].DETPRESUPTIRAJE_TOTAL+" unidades</td>\
                            </tr>\
                            <tr>\                                                 <td>Impresión</td>\
                              <td>:</td>\
                              <td class='descripcion'>"+colores+" "+ impresion+"</td>\
                            </tr>\
                            <tr>\                                                 <td>Material</td>\
                              <td>:</td>\
                              <td class='descripcion'>"+datos[i].DETPRESUPTIP_PAPEL+" "+ datos[i].DETPRESUPGRAMAJE +" GRS."+"</td>\
                              <td><button  class='btn green h3-responsible' style='margin-left:50%'  id="+datos[i].ITPRESUNUMERO+" onclick='cambiarEstadoItemPresupuesto(this.id,56);return false'>/</button></td>\
                              <td><button  class='btn red h3-responsible' value="+datos[i].ITPRESUNUMERO+" onclick='cambiarEstadoItemPresupuesto(this.value,57);return false'>X</button></td>\
                              <td class='font-weight-bold'>"+datos[i].ESTDESCRIPCION+"</td>\
                            </tr>\
                            <tr>\                                                 <td>Medidas</td>\
                              <td>:</td>\
                              <td class='descripcion'>"+datos[i].ITPRESUMEDIDAS +"</td>\
                            </tr>";

                if(acabados!=""){
                    tablaItem+="<tr>\                                                 <td>Acabados</td>\
                                  <td>:</td>\
                                  <td class='descripcion'>"+acabados+"</td>\
                              </tr>";
                }

                if(tipoItem=="NO"){
                    if(datos[i].ESTADO!="14" || datos[i].ESTADO!="17" ){
                      actualizarEstadoItemOP(datos[i].ESTDESCRIPCION,datos[i].ITPRESUCODIGO);
                      if(datos[i].ESTDESCRIPCION=="ACEPTADO"){
                        cantidadaceptado=cantidadaceptado+1;
                      }
                    }
                    tablaItem+="<tr>\                                                 <td>Valor de Venta</td>\
                              <td>:</td>\
                              <td class='descripcion red-text font-weight-bold text-left'>"+datos[i].ITPRESUIMPORTE+ " + IGV"+"</td>\
                              <td colspan='2'><button  class='btn principal h3-responsible' style='margin-left:25%'  id="+datos[i].ITPRESUCODIGO+" onclick='agregarSubItem(this.id);return false'>AGREGAR SUB ITEM</button></td>\
                            </tr>";
                }
                if(respuesta=="SI" ){
                  if(datos[i].ITPRESUIMPORTE.substr(0,1)=="S"){
                       tablaItem+="<tr>\                                                 <td>Valor de Venta</td>\
                              <td>:</td>\
                              <td class='descripcion red-text font-weight-bold text-left'>S/"+costoItem[posicion]+ " + IGV"+"</td>\
                              <td colspan='2'><button  class='btn principal h3-responsible' style='margin-left:25%'  id="+datos[i].ITPRESUCODIGO+" onclick='agregarSubItem(this.id);return false'>AGREGAR SUB ITEM</button></td>\
                            </tr>";
                  }else{
                       tablaItem+="<tr>\                                                 <td>Valor de Venta</td>\
                              <td>:</td>\
                              <td class='descripcion red-text font-weight-bold text-left'>$"+costoItem[posicion]+ " + IGV"+"</td>\
                              <td colspan='2'><button  class='btn principal h3-responsible' style='margin-left:25%'  id="+datos[i].ITPRESUCODIGO+" onclick='agregarSubItem(this.id);return false'>AGREGAR SUB ITEM</button></td>\
                            </tr>";
                  }
                  
                  if(datos[i].ESTADO!="14" || datos[i].ESTADO!="17"){
                      if(estadoAceptado[posicion]=="NO"){
                        actualizarEstadoItemOP("NO ACEPTADO",datos[i].ITPRESUCODIGO)
                      }else{
                        actualizarEstadoItemOP("ACEPTADO",datos[i].ITPRESUCODIGO)
                        cantidadaceptado=cantidadaceptado+1
                      }
                    }
                  respuesta="NO";
                  tipoItem="NO";
                }

                var inicial=datos[i].ITPRESUIMPORTE.substr(0,1);
                if( inicial=='$' && datos[i].ESTDESCRIPCION=="ACEPTADO"){
                    tipoMonedaDolares = inicial; 
                    precioDolares += parseFloat(datos[i].ITPRESUIMPORTE.substr(1)); 
                }else if (inicial=='S' && datos[i].ESTDESCRIPCION=="ACEPTADO"){
                    tipoMonedaSoles = inicial;
                    precioSoles += parseFloat(datos[i].ITPRESUIMPORTE.substr(3));
                }  

          }
            
              if(precioSoles !=""){
                valorTotalSoles += tipoMonedaSoles+"/"+precioSoles+" + IGV" + "<br/>";
                valorVenta += tipoMonedaSoles+"/"+precioSoles+" + IGV" + "<br/>";
              }
              if(precioDolares != ""){
                valorTotalDolares += tipoMonedaDolares + precioDolares +"+ IGV " + "<br/>";
                valorVenta += tipoMonedaDolares + precioDolares +"+ IGV" + "<br/>";
              }
              if(valorTotalSoles!="VALOR TOTAL EN SOLES : "){
                valorTotal+=valorTotalSoles;
              }
              if(valorTotalDolares !="VALOR TOTAL EN DOLARES : "){
                valorTotal += valorTotalDolares;
              }
              actualizarPresupuesto(datos[0].PRESUPNUMERO,itemstotales,"S/".concat(precioSoles),"$".concat(precioDolares));
              actualizarCantidadOrdenProduccion(cantidadaceptado,datos[0].PRESUPNUMERO)
              $("#detalleItem").html(tablaItem);   
              $("#valorTotal").html(valorTotal);
              $("#divAgregarItem").removeClass("d-none");
            
              $("#persona").val(datos[0].PRESUPPERS_CONTACTO);
              $("#cliente").val(datos[0].CLIENCODIGO);
              $("#vendedor").val(datos[0].PRESUPVENDEDOR);
              $("#montoSoles").val(datos[0].PRESUPTOTAL_SOLES);
              $("#montoDolares").val(datos[0].PRESUPTOTAL_DOLARES);
            } 
        }
    });
}
  
/* AGREGAR UN NUEVO ITEM AL PRESUPUESTO */
function agregarItem(){
  var presupuesto = $("#nPresupuesto").html().split(": ")[1];
  var nuevoItem="";
  var vendedor="";var empresa="";
  $.ajax({
      url: '../CT-BackEnd/Controlador/ModPresupuesto/Controlador_MostrarTodosPptos.php',
      type: 'GET',
      dataType: 'json',
      error: function(error){
          if(error.status == 401){
              mostrarMensaje("error","No se pudo establecer conexion con el servidor");
          }
          else{
              mostrarMensaje("error","Error no identificado");
          }
      },
      success: function(datos){
          if(datos.response == 0){
          }
          else{
            for(var i=0;i<datos.length;i++){
              if(presupuesto == datos[i].PRESUPNUMERO){
                  nuevoItem= datos[i].PRESUPNUMERO.concat("-").concat(parseInt(datos[i].PRESUPCANT_ITEM)+1);
                  vendedor=  datos[i].PRESUPVENDEDOR ;
                  empresa=  datos[i].CLIENCODIGO ;
                }
            }
            NuevoItem(nuevoItem,vendedor,empresa);
          }
      }
  });
}
  
function agregarSubItem(codigo){
  var presupuesto = $("#nPresupuesto").html().split(": ")[1];
  var nuevoItem="";
  var vendedor="";var empresa="";
  $.ajax({
      url: '../CT-BackEnd/Controlador/ModPresupuesto/Controlador_MostrarTodosPptos.php',
      type: 'GET',
      dataType: 'json',
      error: function(error){
          if(error.status == 401){
              mostrarMensaje("error","No se pudo establecer conexion con el servidor");
          }
          else{
              mostrarMensaje("error","Error no identificado");
          }
      },
      success: function(datos){
          if(datos.response == 0){
          }
          else{
            for(var i=0;i<datos.length;i++){
              if(presupuesto == datos[i].PRESUPNUMERO){
                  nuevoItem= codigo;
                  vendedor=  datos[i].PRESUPVENDEDOR ;
                  empresa=  datos[i].CLIENCODIGO ;
                }
            }
            NuevoItem(nuevoItem,vendedor,empresa);
          }
      }
  });
}
    
/* ACTUALIZAR INFORMACION DEL PRESUPUESTO */
function actualizarPresupuesto(codigoP,cantItem,totalSoles,totalDolares){
  
  var $datos = {
      '_code': codigoP ,
      '_cantItem' : cantItem,
      '_totalSoles' : totalSoles,
      '_totalDolares' :totalDolares
    }
    
    $.ajax({
      url: '../CT-BackEnd/Controlador/ModPresupuesto/Controlador_RegistrarTotalPresupuesto.php',
      type: 'POST',
      data: $datos,
      dataType: 'json',
      error: function(error){
        if(error.status == 401){
            mostrarMensaje("error","No se pudo establecer conexion con el servidor");
        }
        else{
            mostrarMensaje("error","Error no identificado");
        }
      },
      success: function(datos){

        if(datos.response == 0){
            mostrarMensaje("error","ERROR: "+datos.message);
        }
        else{
            mostrarMensaje("exito","PRESUPUESTO " + codigoP );
            var $codigo={
                '_codigo': codigoP }

            $.ajax({
                url: '../CT-BackEnd/Controlador/ModPresupuesto/Controlador_ValidarPresupuesto.php',
                type: 'POST',
                data: $codigo,
                dataType: 'json',
                error: function(error){
                    if(error.status == 401){
                        mostrarMensaje("error","Archivos no encontrados");
                    }
                    else{
                        mostrarMensaje("error","Error no identificado");
                    }
                },
                success: function(dato){

                  if(dato.response=="0"){
                  }
                  else{
                      $("#persona").val(dato[0].PRESUPPERS_CONTACTO);
                      $("#cliente").val(dato[0].CLIENCODIGO);
                      $("#vendedor").val(dato[0].PRESUPVENDEDOR);
                      $("#montoSoles").val(dato[0].PRESUPTOTAL_SOLES);
                      $("#montoDolares").val(dato[0].PRESUPTOTAL_DOLARES);
                  }
                }
            });
        }
        }
    });
}
  
  /* ACTUALIZAR ESTADO ITEM PRESUPUESTO */ 
function cambiarEstadoItemPresupuesto(codigo,estado){
  var $codigo= {
    '_codigo': codigo,
    '_estado': estado
  }
  
  $.ajax({
        url: '../CT-BackEnd/Controlador/ModPresupuesto/Controlador_ActualizarEstadoItemPresupuesto.php',
        type: 'POST',
        data: $codigo,
        dataType: 'json',
        error: function(error){
            if(error.status == 401){
                mostrarMensaje("error","Archivos no encontrados");
            }
            else{
                mostrarMensaje("error","Error no identificado");
            }
        },
        success: function(datos){
 
          if(datos.response=="0"){
              mostrarMensaje("error","Error "+datos.message);
          }
          else{
              mostrarMensaje("exito","ITEM ACTUALIZADO");
              mostrarItem($("#presupuestos").val())
          }
        }
  });  
}
  
  /* ACTUALIZAR ESTADO ITEM ORDEN PRODUCCION*/
function actualizarEstadoItemOP(estado,item){
  var estcodigo;
  if(estado=="ACEPTADO"){
    estcodigo=58;
  }else{
    estcodigo=59
  }
  var $datos={
    '_estado':estcodigo,
    '_codigoItemPresupuesto': item
  }
  $.ajax({
    url: '../CT-BackEnd/Controlador/ModOrden/Controlador_ActualizarEstadoItemOrdenProduccion.php',
    type: 'POST',
    data: $datos,
    dataType: 'json',
    error: function(error){
        if(error.status == 401){
            mostrarMensaje("error","Archivos no encontrados");
        }
        else{
            mostrarMensaje("error","Error no identificado");
        }
    },
    success: function(datos){
      if(datos.response=="0"){
          mostrarMensaje("error","Error "+datos.message);
      }
    }
  }); 
  
}
  
function actualizarCantidadOrdenProduccion(cantidad,presupuesto){
  var $datos={
    '_cantidad':cantidad,
    '_presupuesto': presupuesto
  }
  $.ajax({
    url: '../CT-BackEnd/Controlador/ModOrden/Controlador_ActualizarCantidadOrdenProduccion.php',
    type: 'POST',
    data: $datos,
    dataType: 'json',
    error: function(error){
        if(error.status == 401){
            mostrarMensaje("error","Archivos no encontrados");
        }
        else{
            mostrarMensaje("error","Error no identificado");
        }
    },
    success: function(datos){
      if(datos.response=="0"){
          mostrarMensaje("error","Error "+datos.message);
      }
    }
  }); 
}
</script>